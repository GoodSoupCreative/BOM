{"version":3,"file":"index.modern.js","sources":["../src/hooks/useScript.ts","../src/hooks/useAcceptJs.ts","../src/HostedForm/HostedForm.tsx","../src/AcceptHosted/RedirectIntegration/RedirectIntegration.tsx","../src/AcceptHosted/IFrameIntegration/helpers.ts","../src/AcceptHosted/IFrameIntegration/styles.ts","../src/hooks/useWindowSize.tsx","../src/AcceptHosted/IFrameIntegration/IFrameIntegration.tsx","../src/AcceptHosted/AcceptHosted.tsx"],"sourcesContent":["import * as React from 'react';\n\nconst cachedScripts: string[] = [];\n\nfunction useScript(\n  url: string,\n  async = true,\n  appendToHeadOrBody: 'head' | 'body' = 'head'\n) {\n  const [state, setState] = React.useState({\n    loaded: false,\n    error: false,\n  });\n\n  React.useEffect(() => {\n    if (cachedScripts.includes(url)) {\n      setState({\n        loaded: true,\n        error: false,\n      });\n    } else {\n      cachedScripts.push(url);\n\n      const script = document.createElement('script');\n      script.src = url;\n      script.async = async;\n\n      const onScriptLoad = () => {\n        setState({\n          loaded: true,\n          error: false,\n        });\n      };\n\n      const onScriptError = () => {\n        const index = cachedScripts.indexOf(url);\n        if (index >= 0) cachedScripts.splice(index, 1);\n        script.remove();\n\n        setState({\n          loaded: true,\n          error: true,\n        });\n      };\n\n      script.addEventListener('load', onScriptLoad);\n      script.addEventListener('error', onScriptError);\n\n      appendToHeadOrBody === 'head'\n        ? document.head.appendChild(script)\n        : document.body.appendChild(script);\n\n      return () => {\n        script.removeEventListener('load', onScriptLoad);\n        script.removeEventListener('error', onScriptError);\n      };\n    }\n    return undefined;\n  }, [url, async, appendToHeadOrBody]);\n\n  return [state.loaded, state.error];\n}\n\nexport default useScript;\n","import { useState, useEffect } from 'react';\n\nimport useScript from './useScript';\nimport {\n  PaymentData,\n  DispatchDataResponse,\n  SecureData,\n  AcceptJsHookConfig,\n} from '../types';\n\nconst useAcceptJs = ({\n  environment = 'SANDBOX',\n  authData,\n}: AcceptJsHookConfig) => {\n  const [loading, setLoading] = useState(true);\n  const scriptUrl =\n    environment === 'PRODUCTION'\n      ? 'https://js.authorize.net/v1/Accept.js'\n      : 'https://jstest.authorize.net/v1/Accept.js';\n  const [scriptLoaded, scriptError] = useScript(scriptUrl);\n\n  useEffect(() => {\n    if (scriptLoaded || scriptError) {\n      setLoading(false);\n    }\n  }, [scriptLoaded, scriptError]);\n\n  const dispatchData = (paymentData: PaymentData) => {\n    const payload: SecureData = paymentData.cardData\n      ? { cardData: paymentData.cardData, authData }\n      : { bankData: paymentData.bankData, authData };\n    return new Promise<DispatchDataResponse>((resolve, reject) => {\n      if (window) {\n        window.Accept.dispatchData(\n          payload,\n          (response: DispatchDataResponse) => {\n            if (response.messages.resultCode === 'Ok') {\n              resolve(response);\n            }\n            reject(response);\n          }\n        );\n      }\n    });\n  };\n  return { dispatchData, loading, error: scriptError };\n};\n\nexport default useAcceptJs;\n","import * as React from 'react';\n\nimport {\n  HostedFormProps,\n  HostedFormResponseHandlerFn,\n  ErrorMessage,\n} from '../types';\nimport useScript from '../hooks/useScript';\n\nconst HostedForm = ({\n  authData,\n  onSubmit,\n  environment = 'SANDBOX',\n  billingAddressOptions = { show: true, required: true },\n  buttonText = 'Pay',\n  formButtonText = 'Pay',\n  formHeaderText = 'Pay',\n  paymentOptions = { showCreditCard: true, showBankAccount: false },\n  buttonStyle,\n  buttonClassName,\n  errorTextStyle,\n  errorTextClassName,\n  containerStyle,\n  containerClassName,\n  disabled,\n}: HostedFormProps) => {\n  const [loading, setLoading] = React.useState(true);\n  const scriptUrl =\n    environment === 'PRODUCTION'\n      ? 'https://js.authorize.net/v3/AcceptUI.js'\n      : 'https://jstest.authorize.net/v3/AcceptUI.js';\n  const [scriptLoaded, scriptError] = useScript(scriptUrl);\n\n  React.useEffect(() => {\n    if (scriptLoaded || scriptError) {\n      setLoading(false);\n    }\n  }, [scriptLoaded, scriptError]);\n  const [errors, setErrors] = React.useState<string | ErrorMessage[] | null>(\n    null\n  );\n\n  const responseHandler: HostedFormResponseHandlerFn = React.useCallback(\n    (response) => {\n      if (response.messages.resultCode === 'Error') {\n        setErrors(response.messages.message);\n      } else {\n        onSubmit(response);\n      }\n    },\n    [onSubmit]\n  );\n\n  React.useEffect(() => {\n    if (!scriptError && !loading && !window.responseHandler)\n      window.responseHandler = responseHandler;\n    if (scriptError)\n      setErrors(\n        'There was a problem loading the Accept.JS script. Please try again.'\n      );\n  }, [loading, scriptError, responseHandler]);\n\n  return (\n    <div\n      style={containerStyle}\n      className={containerClassName ? containerClassName : undefined}\n    >\n      <button\n        type=\"button\"\n        style={buttonStyle}\n        className={buttonClassName ? `AcceptUI ${buttonClassName}` : 'AcceptUI'}\n        data-billingaddressoptions={JSON.stringify(billingAddressOptions)}\n        data-apiloginid={authData.apiLoginID}\n        data-clientkey={authData.clientKey}\n        data-acceptuiformbtntxt={formButtonText}\n        data-acceptuiformheadertxt={formHeaderText}\n        data-paymentoptions={JSON.stringify(paymentOptions)}\n        data-responsehandler=\"responseHandler\"\n        disabled={scriptError || loading || disabled}\n      >\n        {buttonText}\n      </button>\n\n      {errors && (\n        <div style={errorTextStyle} className={errorTextClassName ?? ''}>\n          {typeof errors === 'string'\n            ? errors\n            : errors.map((error, index) => (\n                <div key={`error-${index}`}>\n                  `Error (${error.code}): ${error.text})`\n                </div>\n              ))}\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default HostedForm;\n","import React from 'react';\n\nimport { AcceptHostedRedirectIntegrationProps } from '../../types';\n\nexport const RedirectIntegration = ({\n  formToken,\n  postUrl,\n  children,\n  className,\n  style,\n}: AcceptHostedRedirectIntegrationProps) => (\n  <form method=\"post\" action={postUrl}>\n    <input type=\"hidden\" name=\"token\" value={formToken} />\n    <button className={className} style={className ? {} : style}>\n      {children}\n    </button>\n  </form>\n);\n\nexport default RedirectIntegration;\n","export const parseQueryString = (queryString: string) => {\n  const arr = queryString.split('&');\n  return arr.reduce((acc, curr) => {\n    const [key, value] = curr.split('=');\n    acc[key] = value;\n    return acc;\n  }, {} as { [key: string]: string });\n};\n","import React from 'react';\n\nexport const defaultBackdropStyle: React.CSSProperties = {\n  position: 'fixed',\n  left: '0px',\n  top: '0px',\n  width: '100%',\n  height: '100%',\n  zIndex: 1,\n  backgroundColor: '#808080',\n  opacity: '0.5',\n  filter: 'alpha(opacity=50)',\n};\n\nexport const defaultContainerStyle: React.CSSProperties = {\n  borderRadius: '6px',\n  position: 'fixed',\n  boxShadow: 'rgba(0, 0, 0, 0.4) 5px 5px 16px',\n  zIndex: 999999,\n  display: 'block',\n  overflow: 'hidden',\n  left: '50%',\n  top: '50%',\n  backgroundColor: '#ffffff',\n};\n","import { useState, useEffect } from 'react';\n\ntype Size = {\n  width: number | undefined;\n  height: number | undefined;\n};\n\nfunction useWindowSize(): Size {\n  const [windowSize, setWindowSize] = useState<Size>({\n    width: undefined,\n    height: undefined,\n  });\n  useEffect(() => {\n    function handleResize() {\n      setWindowSize({\n        width: window.innerWidth,\n        height: window.innerHeight,\n      });\n    }\n    window.addEventListener('resize', handleResize);\n    handleResize();\n    return () => window.removeEventListener('resize', handleResize);\n  }, []);\n  return windowSize;\n}\n\nexport default useWindowSize;\n","import React from 'react';\n\nimport {\n  AcceptHostedTransactionResponse,\n  AcceptHostedIFrameIntegrationProps,\n  CompoundComponentCommonProps,\n  CompoundComponentWithChildrenProps,\n  IFrameIntegrationContext,\n} from '../../types';\nimport { parseQueryString } from './helpers';\nimport { defaultBackdropStyle, defaultContainerStyle } from './styles';\nimport useWindowSize from '../../hooks/useWindowSize';\n\nconst IFrameIntegrationContext =\n  React.createContext<IFrameIntegrationContext | null>(null);\n\nexport const useIFrameIntegrationContext = () => {\n  const context = React.useContext(IFrameIntegrationContext);\n  if (!context) {\n    throw new Error(\n      `AcceptHosted compound components cannot be rendered outside the AcceptHosted component`\n    );\n  }\n  return context;\n};\n\nexport const IFrameIntegration = ({\n  formToken,\n  postUrl,\n  onTransactionResponse,\n  onCancel,\n  onSuccessfulSave,\n  onResize,\n  children,\n}: AcceptHostedIFrameIntegrationProps) => {\n  const [popupIsShown, setPopupIsShown] = React.useState(false);\n  const popupFormRef = React.useRef<HTMLFormElement>(null);\n  const popupRef = React.useRef<HTMLDivElement>(null);\n  const iFrameRef = React.useRef<HTMLIFrameElement>(null);\n\n  const handleShowPopup = () => {\n    setPopupIsShown(true);\n  };\n\n  const handleClosePopup = () => {\n    setPopupIsShown(false);\n  };\n\n  const contextValue = {\n    popupIsShown,\n    popupFormRef,\n    popupRef,\n    iFrameRef,\n    formToken,\n    postUrl,\n    handleShowPopup,\n    handleClosePopup,\n  };\n\n  // const centerPopup = () => {\n  //   if (popupRef.current) {\n  //     popupRef.current.style.left = '50%';\n  //     popupRef.current.style.top = '50%';\n  //     const left = -Math.floor(popupRef.current.clientWidth / 2);\n  //     const top = -Math.floor(popupRef.current.clientHeight / 2);\n  //     popupRef.current.style.marginLeft = `${left.toString()}px`;\n  //     popupRef.current.style.marginTop = `${top.toString()}px`;\n  //     popupRef.current.style.zIndex = '2';\n  //     if (popupRef.current.offsetLeft < 16) {\n  //       popupRef.current.style.left = '16px';\n  //       popupRef.current.style.right = '16px';\n  //       popupRef.current.style.marginLeft = '0px';\n  //     }\n  //     if (popupRef.current.offsetTop < 16) {\n  //       popupRef.current.style.top = '16px';\n  //       popupRef.current.style.marginTop = '0px';\n  //     }\n  //   }\n  // };\n\n  // React.useEffect(() => {\n  //   if (popupIsShown) {\n  //     centerPopup();\n  //   }\n  // }, [popupIsShown]);\n\n  React.useEffect(() => {\n    if (!window.AuthorizeNetIFrame) {\n      window.AuthorizeNetIFrame = {\n        onReceiveCommunication: (querystr) => {\n          const params = parseQueryString(querystr);\n          switch (params['action']) {\n            case 'successfulSave':\n              if (onSuccessfulSave) onSuccessfulSave();\n              handleClosePopup();\n              break;\n            case 'cancel':\n              if (onCancel) onCancel();\n              handleClosePopup();\n              break;\n            case 'transactResponse':\n              const response = params['response'] as string;\n              let parsedResponse: AcceptHostedTransactionResponse;\n              if (response) {\n                parsedResponse = JSON.parse(response);\n                onTransactionResponse(parsedResponse);\n              } else {\n                console.error(\n                  'Did not receive a transaction response despite receiving a transactResponse action!'\n                );\n              }\n              handleClosePopup();\n              break;\n            case 'resizeWindow':\n              const width = params['width'] as string;\n              const height = params['height'] as string;\n              if (width && height) {\n                const w = parseInt(width);\n                const h = parseInt(height);\n                if (iFrameRef.current && popupRef.current) {\n                  iFrameRef.current.style.width = '100%';\n                  iFrameRef.current.style.height = `${h.toString()}px`;\n                  popupRef.current.style.height = `${h.toString()}px`;\n                  // centerPopup();\n                }\n                if (onResize) onResize(w, h);\n              }\n              break;\n            default:\n              break;\n          }\n        },\n      };\n    }\n  });\n\n  return (\n    <IFrameIntegrationContext.Provider value={contextValue}>\n      {children}\n    </IFrameIntegrationContext.Provider>\n  );\n};\n\nexport const IFrameIntegrationButton = ({\n  children,\n  className,\n}: CompoundComponentWithChildrenProps) => {\n  const { postUrl, handleShowPopup, formToken, popupIsShown } =\n    useIFrameIntegrationContext();\n  return (\n    <form\n      method=\"post\"\n      action={postUrl}\n      id=\"formAuthorizeNetPopup\"\n      name=\"formAuthorizeNetPopup\"\n      target=\"iframeAuthorizeNet\"\n      onSubmit={handleShowPopup}\n    >\n      <input type=\"hidden\" id=\"popupToken\" name=\"token\" value={formToken} />\n      <button disabled={popupIsShown} className={className}>\n        {children}\n      </button>\n    </form>\n  );\n};\n\nexport const IFrameContainer = ({\n  children,\n  className,\n  style,\n}: CompoundComponentWithChildrenProps) => {\n  const { popupIsShown, popupRef } = useIFrameIntegrationContext();\n  const windowSize = useWindowSize();\n  const [offsetWidth, setOffsetWidth] = React.useState(0);\n  const [offsetHeight, setOffsetHeight] = React.useState(0);\n\n  // React.useEffect(() => {\n  //   if (popupIsShown) {\n  //     debugger;\n  //   }\n  // }, [popupIsShown]);\n\n  React.useEffect(() => {\n    setOffsetWidth(Math.floor((popupRef.current?.clientWidth || 0) / 2));\n    setOffsetHeight(Math.floor((popupRef.current?.clientHeight || 0) / 2));\n  }, [popupRef]);\n\n  return (\n    <div\n      className={className}\n      ref={popupRef}\n      style={\n        className\n          ? { display: popupIsShown ? '' : 'none' }\n          : {\n              ...defaultContainerStyle,\n              ...style,\n              display: popupIsShown ? '' : 'none',\n              width: windowSize.width\n                ? windowSize.width > 576\n                  ? '70%'\n                  : '300px'\n                : '300px',\n              height: '90%',\n              marginLeft: `-${offsetWidth}px`,\n              marginTop: `-${offsetHeight}px`,\n            }\n      }\n    >\n      {children}\n    </div>\n  );\n};\n\nexport const IFrameBackdrop = ({\n  className,\n  style,\n}: CompoundComponentCommonProps) => {\n  const { popupIsShown } = useIFrameIntegrationContext();\n\n  return (\n    <div\n      className={className}\n      style={\n        className\n          ? { display: popupIsShown ? '' : 'none' }\n          : {\n              ...defaultBackdropStyle,\n              ...style,\n              display: popupIsShown ? '' : 'none',\n            }\n      }\n    />\n  );\n};\n\nexport const IFrame = ({ className, style }: CompoundComponentCommonProps) => {\n  return (\n    <iframe\n      name=\"iframeAuthorizeNet\"\n      id=\"iframeAuthorizeNet\"\n      frameBorder=\"0\"\n      scrolling=\"no\"\n      width=\"100%\"\n      height=\"100%\"\n      className={className}\n      style={className ? {} : style}\n    ></iframe>\n  );\n};\n","import * as React from 'react';\nimport RedirectIntegration from './RedirectIntegration';\nimport {\n  IFrameIntegration,\n  IFrameIntegrationButton,\n  IFrameContainer,\n  IFrame,\n  IFrameBackdrop,\n} from './IFrameIntegration';\nimport { AcceptHostedProps, AcceptHostedComposition } from '../types';\n\nconst AcceptHosted: AcceptHostedComposition = (props: AcceptHostedProps) => {\n  const postUrl =\n    props.environment === 'PRODUCTION'\n      ? 'https://accept.authorize.net/payment/payment'\n      : 'https://test.authorize.net/payment/payment';\n\n  if (props.integration === 'redirect') {\n    return (\n      <RedirectIntegration formToken={props.formToken} postUrl={postUrl}>\n        {props.children}\n      </RedirectIntegration>\n    );\n  }\n  if (props.integration === 'iframe') {\n    return (\n      <IFrameIntegration\n        formToken={props.formToken}\n        postUrl={postUrl}\n        onTransactionResponse={props.onTransactionResponse}\n        onCancel={props.onCancel}\n        onResize={props.onResize}\n        onSuccessfulSave={props.onSuccessfulSave}\n      >\n        {props.children}\n      </IFrameIntegration>\n    );\n  }\n  return null;\n};\n\nAcceptHosted.Button = IFrameIntegrationButton;\nAcceptHosted.IFrameContainer = IFrameContainer;\nAcceptHosted.IFrameBackdrop = IFrameBackdrop;\nAcceptHosted.IFrame = IFrame;\n\nexport default AcceptHosted;\n"],"names":["cachedScripts","useScript","url","async","appendToHeadOrBody","React","loaded","error","state","setState","includes","push","script","document","createElement","src","onScriptLoad","onScriptError","index","indexOf","splice","remove","addEventListener","head","appendChild","body","removeEventListener","undefined","useAcceptJs","environment","authData","useState","loading","setLoading","scriptUrl","scriptLoaded","scriptError","useEffect","dispatchData","paymentData","payload","cardData","bankData","Promise","resolve","reject","window","Accept","response","messages","resultCode","HostedForm","onSubmit","billingAddressOptions","show","required","buttonText","formButtonText","formHeaderText","paymentOptions","showCreditCard","showBankAccount","buttonStyle","buttonClassName","errorTextStyle","errorTextClassName","containerStyle","containerClassName","disabled","errors","setErrors","responseHandler","message","style","className","type","JSON","stringify","apiLoginID","clientKey","map","key","code","text","RedirectIntegration","formToken","postUrl","children","method","action","name","value","parseQueryString","queryString","arr","split","reduce","acc","curr","defaultBackdropStyle","position","left","top","width","height","zIndex","backgroundColor","opacity","filter","defaultContainerStyle","borderRadius","boxShadow","display","overflow","useWindowSize","windowSize","setWindowSize","handleResize","innerWidth","innerHeight","IFrameIntegrationContext","createContext","useIFrameIntegrationContext","context","useContext","Error","IFrameIntegration","onTransactionResponse","onCancel","onSuccessfulSave","onResize","popupIsShown","setPopupIsShown","popupFormRef","useRef","popupRef","iFrameRef","handleShowPopup","handleClosePopup","contextValue","AuthorizeNetIFrame","onReceiveCommunication","querystr","params","parsedResponse","parse","console","w","parseInt","h","current","toString","Provider","IFrameIntegrationButton","id","target","IFrameContainer","offsetWidth","setOffsetWidth","offsetHeight","setOffsetHeight","Math","floor","clientWidth","clientHeight","ref","marginLeft","marginTop","IFrameBackdrop","IFrame","frameBorder","scrolling","AcceptHosted","props","integration","Button"],"mappings":"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"}